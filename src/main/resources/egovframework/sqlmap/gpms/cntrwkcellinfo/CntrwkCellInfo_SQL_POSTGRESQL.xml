<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="cntrwkCellInfoDAO">
 
	<typeAlias alias="egovMap"	type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias  alias="cntrwkCellInfoSerarchVO" type="kr.go.gg.gpms.cntrwkcellinfo.service.model.CntrwkCellInfoDefaultVO"/>
	<typeAlias alias="cntrwkCellInfoVO"	type="kr.go.gg.gpms.cntrwkcellinfo.service.model.CntrwkCellInfoVO" />

	<resultMap id="cntrwkCellInfo.resultMap"
		class="cntrwkCellInfoVO">
		<result property="DETAIL_CNTRWK_ID" column="DETAIL_CNTRWK_ID" columnIndex="1" /> <!-- 공사_셀_정보.세부_공사_ID -->
		<result property="PAV_CELL_ID" column="PAV_CELL_ID" columnIndex="2" /> <!-- 공사_셀_정보.포장_셀_ID -->
		<result property="PAV_YEAR" column="PAV_YEAR" columnIndex="3" /> <!-- 공사_셀_정보.포장_년도 -->
		<result property="CNTRWK_ID" column="CNTRWK_ID" columnIndex="4" /> <!-- 공사_셀_정보.공사_ID -->
	</resultMap>

	<insert id="cntrwkCellInfoDAO.insertCntrwkCellInfo">
	<![CDATA[ 
		/* cntrwkCellInfoDAO.insertCntrwkCellInfo */
		/* 공사_셀_정보 등록 */
		
		INSERT INTO TN_CNTRWK_CELL_INFO (
			DETAIL_CNTRWK_ID /* 공사_셀_정보.세부_공사_ID */
			, PAV_CELL_ID /* 공사_셀_정보.포장_셀_ID */
			, PAV_YEAR /* 공사_셀_정보.포장_년도 */
			, CNTRWK_ID /* 공사_셀_정보.공사_ID */
		) VALUES (
			#DETAIL_CNTRWK_ID# /* 공사_셀_정보.세부_공사_ID */
			, #PAV_CELL_ID# /* 공사_셀_정보.포장_셀_ID */
			, #PAV_YEAR# /* 공사_셀_정보.포장_년도 */
			, #CNTRWK_ID# /* 공사_셀_정보.공사_ID */
		)
]]>
	</insert>

	<update id="cntrwkCellInfoDAO.updateCntrwkCellInfo">
	<![CDATA[ 
		/* cntrwkCellInfoDAO.updateCntrwkCellInfo */
		/* 공사_셀_정보 수정 */
		UPDATE TN_CNTRWK_CELL_INFO SET
		CNTRWK_ID = #CNTRWK_ID# /* 공사_셀_정보.공사_ID */
		, PAV_YEAR = #PAV_YEAR# /* 공사_셀_정보.포장_년도 */
		WHERE 1 = 1
		AND DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID# /* 공사_셀_정보.세부_공사_ID */
		AND PAV_CELL_ID = #PAV_CELL_ID# /* 공사_셀_정보.포장_셀_ID */
]]>
	</update>

	<delete id="cntrwkCellInfoDAO.deleteCntrwkCellInfo">
	<![CDATA[ 
		/* cntrwkCellInfoDAO.deleteCntrwkCellInfo */
		/* 공사_셀_정보 삭제 */
		DELETE FROM TN_CNTRWK_CELL_INFO
		WHERE 1 = 1
]]>		
		<isNotEmpty property="DETAIL_CNTRWK_ID"><![CDATA[ /* 공사_셀_정보.세부_공사_ID */ AND DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID#  ]]></isNotEmpty>
		<isNotEmpty property="PAV_CELL_ID"><![CDATA[ /* 공사_셀_정보.포장_셀_ID */ AND PAV_CELL_ID = #PAV_CELL_ID# ]]></isNotEmpty>
		<isNotEmpty property="CNTRWK_ID"><![CDATA[ /* 공사_셀_정보.공사_ID */ AND CNTRWK_ID = #CNTRWK_ID# ]]></isNotEmpty>
	</delete>

	<select id="cntrwkCellInfoDAO.selectCntrwkCellInfo"
		resultMap="cntrwkCellInfo.resultMap">
	<![CDATA[ 
		/* cntrwkCellInfoDAO.selectCntrwkCellInfo */
		/* 공사_셀_정보 조회 */
		SELECT
			tncntrwkcellinfo.DETAIL_CNTRWK_ID /* 공사_셀_정보.세부_공사_ID */
			, tncntrwkcellinfo.PAV_CELL_ID /* 공사_셀_정보.포장_셀_ID */
			, tncntrwkcellinfo.PAV_YEAR /* 공사_셀_정보.포장_년도 */
			, tncntrwkcellinfo.CNTRWK_ID /* 공사_셀_정보.공사_ID */
		FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfo
		WHERE 1 = 1
		AND tncntrwkcellinfo.DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID# /* 공사_셀_정보.세부_공사_ID */
		AND tncntrwkcellinfo.PAV_CELL_ID = #PAV_CELL_ID# /* 공사_셀_정보.포장_셀_ID */
]]>
	</select>

	<sql id="cntrwkCellInfoDAO.selectCntrwkCellInfoList.where">
		WHERE 1 = 1

		<isEqual property="searchCondition" compareValue="0">
			<![CDATA[
				AND tncntrwkcellinfo.DETAIL_CNTRWK_ID = #searchKeyword#
			]]>
		</isEqual>
		<isEqual property="searchCondition" compareValue="1">
			<![CDATA[
				AND tncntrwkcellinfo.PAV_CELL_ID LIKE '%' || #searchKeyword# || '%'
			]]>
		</isEqual>
		<isNotEmpty property="DETAIL_CNTRWK_ID"><![CDATA[ /* 공사_셀_정보.세부_공사_ID */ AND tncntrwkcellinfo.DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID# ]]></isNotEmpty>
		<isNotEmpty property="PAV_CELL_ID"><![CDATA[ /* 공사_셀_정보.포장_셀_ID */ AND tncntrwkcellinfo.PAV_CELL_ID = #PAV_CELL_ID# ]]></isNotEmpty>
		<isNotEmpty property="PAV_YEAR"><![CDATA[ /* 공사_셀_정보.포장_년도 */ AND tncntrwkcellinfo.PAV_YEAR = #PAV_YEAR# ]]></isNotEmpty>
		<isNotEmpty property="CNTRWK_ID"><![CDATA[ /* 공사_셀_정보.공사_ID */ AND tncntrwkcellinfo.CNTRWK_ID = #CNTRWK_ID# ]]></isNotEmpty>
	</sql>

	<select id="cntrwkCellInfoDAO.selectCntrwkCellInfoList"
		parameterClass="cntrwkCellInfoVO"
		resultClass="cntrwkCellInfoVO">
<![CDATA[ 		
		/* cntrwkCellInfoDAO.selectCntrwkCellInfoList */
		/* 공사_셀_정보 조회 */
		SELECT * FROM (SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
			SELECT
				tncntrwkcellinfo.DETAIL_CNTRWK_ID /* 공사_셀_정보.세부_공사_ID */
				, tncntrwkcellinfo.PAV_CELL_ID /* 공사_셀_정보.포장_셀_ID */
				, tncntrwkcellinfo.PAV_YEAR /* 공사_셀_정보.포장_년도 */
				, tncntrwkcellinfo.CNTRWK_ID /* 공사_셀_정보.공사_ID */
			FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfo
]]>			
		
		<include refid="cntrwkCellInfoDAO.selectCntrwkCellInfoList.where" />

<![CDATA[
 
		ORDER BY  tncntrwkcellinfo.DETAIL_CNTRWK_ID DESC /* 공사_셀_정보.세부_공사_ID */
				, tncntrwkcellinfo.PAV_CELL_ID DESC /* 공사_셀_정보.포장_셀_ID */

 
		) tb)as sub_CntrwkCellInfo WHERE 1=1 
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
		<![CDATA[
			rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
		]]>
		</isEqual>
<![CDATA[
]]>		
	</select>		
 

	<select id="cntrwkCellInfoDAO.selectCntrwkCellInfoListTotalCount"
		parameterClass="cntrwkCellInfoVO"
		resultClass="int">
<![CDATA[ 		
		/* cntrwkCellInfoDAO.selectCntrwkCellInfoListTotalCount */
		/* 공사_셀_정보 목록 개수 조회  */
		SELECT COUNT(*) AS totCnt
		FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfo
]]>		
		<include refid="cntrwkCellInfoDAO.selectCntrwkCellInfoList.where" />
<![CDATA[		
]]>		
	</select>
	
	<select id="cntrwkCellInfoDAO.selectPavYearListByCellId"
		parameterClass="cntrwkCellInfoVO"
		resultClass="cntrwkCellInfoVO">
<![CDATA[ 		
		/* cntrwkCellInfoDAO.selectPavYearListByCellId */
		/* 공사_셀별 직전 포장년도 조회 */
		SELECT * FROM (SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
			SELECT tncntrwkcellinfo.PAV_CELL_ID
			     , MAX(tncntrwkcellinfo.PAV_YEAR) PAV_YEAR 
			  FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfo
			  WHERE 1=1
]]>
	    <isNotEmpty property="PAV_CELL_ID_LIST">
		<![CDATA[ /* 공사_셀_정보 조회.포장_셀_목록 */  ]]>
			<iterate close=")" conjunction="," open="("
				prepend=" AND tncntrwkcellinfo.PAV_CELL_ID IN " property="PAV_CELL_ID_LIST">
				#PAV_CELL_ID_LIST[]#
			</iterate>
		</isNotEmpty>
		<isNotEmpty property="DETAIL_CNTRWK_ID">
		<![CDATA[
			AND tncntrwkcellinfo.PAV_YEAR < (SELECT DISTINCT PAV_YEAR 
		    				  FROM TN_CNTRWK_CELL_INFO 
		    				 WHERE DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID#)
		]]>
		    <isEmpty property="PAV_CELL_ID_LIST">
		    <![CDATA[
			    AND EXISTS (
	                SELECT 't' 
	                  FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfosub
	                 WHERE tncntrwkcellinfosub.PAV_CELL_ID = tncntrwkcellinfo.PAV_CELL_ID
	                   AND tncntrwkcellinfosub.DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID#
	            	)
	        ]]>
            </isEmpty>
			
		</isNotEmpty>
<![CDATA[
		    GROUP BY  PAV_CELL_ID
		) tb) WHERE 1=1 
]]>
		<isEqual prepend=" AND" property="usePage" compareValue="true">
		<![CDATA[
			rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
		]]>
		</isEqual>
	</select>

	<select id="cntrwkCellInfoDAO.selectPavYearListByCellIdTotalCount"
		parameterClass="cntrwkCellInfoVO"
		resultClass="int">
<![CDATA[ 		
		/* cntrwkCellInfoDAO.selectPavYearListByCellIdTotalCount */
		/* 공사_셀별 직전 포장년도 개수 조회  */
		SELECT COUNT(*) FROM (
			SELECT tncntrwkcellinfo.PAV_CELL_ID
			     , MAX(tncntrwkcellinfo.PAV_YEAR) PAV_YEAR 
		  	  FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfo
		 WHERE 1=1
]]>
	    <isNotEmpty property="PAV_CELL_ID_LIST">
		<![CDATA[ /* 공사_셀_정보 조회.포장_셀_목록 */  ]]>
			<iterate close=")" conjunction="," open="("
				prepend=" AND tncntrwkcellinfo.PAV_CELL_ID IN " property="PAV_CELL_ID_LIST">
				#PAV_CELL_ID_LIST[]#
			</iterate>
		</isNotEmpty>
		<isNotEmpty property="DETAIL_CNTRWK_ID">
		<![CDATA[
			AND tncntrwkcellinfo.PAV_YEAR < (SELECT DISTINCT PAV_YEAR 
		    				  FROM TN_CNTRWK_CELL_INFO 
		    				 WHERE DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID#)
		]]>
		    <isEmpty property="PAV_CELL_ID_LIST">
		    <![CDATA[
			    AND EXISTS (
	                SELECT 't' 
	                  FROM TN_CNTRWK_CELL_INFO tncntrwkcellinfosub
	                 WHERE tncntrwkcellinfosub.PAV_CELL_ID = tncntrwkcellinfo.PAV_CELL_ID
	                   AND tncntrwkcellinfosub.DETAIL_CNTRWK_ID = #DETAIL_CNTRWK_ID#
	            	)
	        ]]>
            </isEmpty>
			
		</isNotEmpty>
<![CDATA[
		  GROUP BY tncntrwkcellinfo.PAV_CELL_ID
		 )
		 ORDER BY PAV_YEAR desc, PAV_CELL_ID
]]>		
	</select>
</sqlMap>
