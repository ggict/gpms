<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="srvyDtaExcelDAO">

	<typeAlias alias="egovMap"
		type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="srvyDtaExcelSerarchVO"
		type="kr.go.gg.gpms.srvydtaexcel.service.model.SrvyDtaExcelDefaultVO" />
	<typeAlias alias="srvyDtaExcelVO"
		type="kr.go.gg.gpms.srvydtaexcel.service.model.SrvyDtaExcelVO" />

	<resultMap id="srvyDtaExcel.resultMap" class="srvyDtaExcelVO">
		<result property="SRVY_NO" column="SRVY_NO" columnIndex="1" /> <!-- 조사_자료_엑셀.조사_번호 -->
		<result property="FILE_NO" column="FILE_NO" columnIndex="2" /> <!-- 조사_자료_엑셀.파일_번호 -->
		<result property="DATA_CO" column="DATA_CO" columnIndex="3" /> <!-- 조사_자료_엑셀.데이터_건수 -->
		<result property="ROUTE_CODE" column="ROUTE_CODE" columnIndex="4" /> <!-- 조사_자료_엑셀.노선_코드 -->
		<result property="DIRECT_CODE" column="DIRECT_CODE"
			columnIndex="5" /> <!-- 조사_자료_엑셀.행선_코드 -->
		<result property="TRACK" column="TRACK" columnIndex="6" /> <!-- 조사_자료_엑셀.차로 -->
		<result property="STRTPT" column="STRTPT" columnIndex="7" /> <!-- 조사_자료_엑셀.시점 -->
		<result property="ENDPT" column="ENDPT" columnIndex="8" /> <!-- 조사_자료_엑셀.종점 -->
		<result property="SRVY_DE" column="SRVY_DE" columnIndex="9" /> <!-- 조사_자료_엑셀.조사_일자 -->
		<result property="SRVY_NM" column="SRVY_NM" columnIndex="10" /> <!-- 조사_자료_엑셀.조사_명 -->
		<result property="EXMNR_NM" column="EXMNR_NM" columnIndex="11" /> <!-- 조사_자료_엑셀.조사자_명 -->
		<result property="EVL_PROCESS_AT" column="EVL_PROCESS_AT"
			columnIndex="12" /> <!-- 조사_자료_엑셀.평가_처리_여부 -->
		<result property="SM_PROCESS_AT" column="SM_PROCESS_AT"
			columnIndex="14" /> <!-- 조사_자료_엑셀.집계_처리_여부 -->
		<result property="VAL_EVL_AT" column="VAL_EVL_AT" columnIndex="16" /> <!-- 조사_자료_엑셀.유효성_평가_여부 -->
		<result property="DELETE_AT" column="DELETE_AT" columnIndex="17" /> <!-- 조사_자료_엑셀.삭제_여부 -->
		<result property="USE_AT" column="USE_AT" columnIndex="18" /> <!-- 조사_자료_엑셀.사용_여부 -->
		<result property="CRTR_NO" column="CRTR_NO" columnIndex="19" /> <!-- 조사_자료_엑셀.생성자_번호 -->
		<result property="CREAT_DT" column="CREAT_DT" columnIndex="20" /> <!-- 조사_자료_엑셀.생성_일시 -->
		<result property="UPDUSR_NO" column="UPDUSR_NO" columnIndex="21" /> <!-- 조사_자료_엑셀.수정자_번호 -->
		<result property="UPDT_DT" column="UPDT_DT" columnIndex="22" /> <!-- 조사_자료_엑셀.수정_일시 -->
	</resultMap>

	<insert id="srvyDtaExcelDAO.insertSrvyDtaExcel">
		<selectKey resultClass="String" keyProperty="SRVY_NO">
  <![CDATA[
  select nextval('SEQ_TN_SRVY_DTA_EXCEL')
  ]]>
		</selectKey>
	<![CDATA[
		/* srvyDtaExcelDAO.insertSrvyDtaExcel */
		/* 조사_자료_엑셀 등록 */
		INSERT INTO TN_SRVY_DTA_EXCEL (
			SRVY_NO /* 조사_자료_엑셀.조사_번호 */
			, FILE_NO /* 조사_자료_엑셀.파일_번호 */
			, DATA_CO /* 조사_자료_엑셀.데이터_건수 */
			, ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
			, DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
			, TRACK /* 조사_자료_엑셀.차로 */
			, STRTPT /* 조사_자료_엑셀.시점 */
			, ENDPT /* 조사_자료_엑셀.종점 */
			, SRVY_DE /* 조사_자료_엑셀.조사_일자 */
			, SRVY_NM /* 조사_자료_엑셀.조사_명 */
			, EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
			, EVL_PROCESS_AT /* 조사_자료_엑셀.평가_처리_여부 */
			, GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
			, SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
			, PRDTMDL_PROCESS_AT /* 조사_자료_엑셀.예측모델_처리_여부 */
			, VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
			, DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
			, USE_AT /* 조사_자료_엑셀.사용_여부 */
			, CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
			, CREAT_DT /* 조사_자료_엑셀.생성_일시 */
			, UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
			, UPDT_DT /* 조사_자료_엑셀.수정_일시 */
		) VALUES (
			#SRVY_NO#::int /* 조사_자료_엑셀.조사_번호 */
			, #FILE_NO#::int /* 조사_자료_엑셀.파일_번호 */
			, #DATA_CO#::int /* 조사_자료_엑셀.데이터_건수 */
			, #ROUTE_CODE# /* 조사_자료_엑셀.노선_코드 */
			, #DIRECT_CODE# /* 조사_자료_엑셀.행선_코드 */
			, #TRACK# /* 조사_자료_엑셀.차로 */
			, #STRTPT#::int /* 조사_자료_엑셀.시점 */
			, #ENDPT#::int /* 조사_자료_엑셀.종점 */
			, #SRVY_DE# /* 조사_자료_엑셀.조사_일자 */
			, #SRVY_NM# /* 조사_자료_엑셀.조사_명 */
			, #EXMNR_NM# /* 조사_자료_엑셀.조사자_명 */
			, #EVL_PROCESS_AT# /* 조사_자료_엑셀.평가_처리_여부 */
			, #GPS_CORTN_PROCESS_AT# /* 조사_자료_엑셀.GPS_보정_처리_여부 */
			, #SM_PROCESS_AT# /* 조사_자료_엑셀.집계_처리_여부 */
			, #PRDTMDL_PROCESS_AT# /* 조사_자료_엑셀.예측모델_처리_여부 */
			, #VAL_EVL_AT# /* 조사_자료_엑셀.유효성_평가_여부 */
			, #DELETE_AT# /* 조사_자료_엑셀.삭제_여부 */
			, #USE_AT# /* 조사_자료_엑셀.사용_여부 */
			, #CRTR_NO#::int /* 조사_자료_엑셀.생성자_번호 */
			, NOW() /* 조사_자료_엑셀.생성_일시 */
			, #UPDUSR_NO# /* 조사_자료_엑셀.수정자_번호 */
			, NOW() /* 조사_자료_엑셀.수정_일시 */
		)
]]>
	</insert>

	<update id="srvyDtaExcelDAO.updateSrvyDtaExcel">
<![CDATA[
		/* srvyDtaExcelDAO.updateSrvyDtaExcel */
		/* 조사_자료_엑셀 수정 */
		UPDATE TN_SRVY_DTA_EXCEL SET

		UPDT_DT = NOW() /* 조사_자료_엑셀.수정_일시 */
]]>

		<isNotEmpty property="FILE_NO">
			, FILE_NO = #FILE_NO#::int /*
			조사_자료_엑셀.파일_번호 */
		</isNotEmpty>

		<isNotEmpty property="DATA_CO">
			, DATA_CO = #DATA_CO#::int /*
			조사_자료_엑셀.데이터_건수 */
		</isNotEmpty>

		<isNotEmpty property="ROUTE_CODE">
			, ROUTE_CODE = #ROUTE_CODE# /*
			조사_자료_엑셀.노선_코드 */
		</isNotEmpty>

		<isNotEmpty property="DIRECT_CODE">
			, DIRECT_CODE = #DIRECT_CODE# /*
			조사_자료_엑셀.행선_코드 */
		</isNotEmpty>

		<isNotEmpty property="TRACK">
			, TRACK = #TRACK# /* 조사_자료_엑셀.차로 */
		</isNotEmpty>

		<isNotEmpty property="STRTPT">
			, STRTPT = #STRTPT#::int /* 조사_자료_엑셀.시점 */
		</isNotEmpty>

		<isNotEmpty property="ENDPT">
			, ENDPT = #ENDPT#::int /* 조사_자료_엑셀.종점 */
		</isNotEmpty>

		<isNotEmpty property="SRVY_DE">
			, SRVY_DE = #SRVY_DE# /*
			조사_자료_엑셀.조사_일자 */
		</isNotEmpty>

		<isNotEmpty property="SRVY_NM">
			, SRVY_NM = #SRVY_NM# /* 조사_자료_엑셀.조사_명
			*/
		</isNotEmpty>

		<isNotEmpty property="EXMNR_NM">
			, EXMNR_NM = #EXMNR_NM# /*
			조사_자료_엑셀.조사자_명 */
		</isNotEmpty>

		<isNotEmpty property="EVL_PROCESS_AT">
			, EVL_PROCESS_AT = #EVL_PROCESS_AT#
			/*
			조사_자료_엑셀.평가_처리_여부 */
		</isNotEmpty>

		<isNotEmpty property="GPS_CORTN_PROCESS_AT">
			, GPS_CORTN_PROCESS_AT =
			#GPS_CORTN_PROCESS_AT#
			/* 조사_자료_엑셀.GPS_보정_처리_여부 */
		</isNotEmpty>

		<isNotEmpty property="SM_PROCESS_AT">
			, SM_PROCESS_AT = #SM_PROCESS_AT# /*
			조사_자료_엑셀.집계_처리_여부 */
		</isNotEmpty>

		<isNotEmpty property="PRDTMDL_PROCESS_AT">
			, PRDTMDL_PROCESS_AT =
			#PRDTMDL_PROCESS_AT#
			/* 조사_자료_엑셀.예측모델_처리_여부 */
		</isNotEmpty>

		<isNotEmpty property="VAL_EVL_AT">
			, VAL_EVL_AT = #VAL_EVL_AT# /*
			조사_자료_엑셀.유효성_평가_여부 */
		</isNotEmpty>

		<isNotEmpty property="DELETE_AT">
			, DELETE_AT = #DELETE_AT# /*
			조사_자료_엑셀.삭제_여부 */
		</isNotEmpty>

		<isNotEmpty property="USE_AT">
			, USE_AT = #USE_AT# /* 조사_자료_엑셀.사용_여부
			*/
		</isNotEmpty>

		<isNotEmpty property="CRTR_NO">
			, CRTR_NO = #CRTR_NO#::int /*
			조사_자료_엑셀.생성자_번호 */
		</isNotEmpty>

		<isNotEmpty property="UPDUSR_NO">
			, UPDUSR_NO = #UPDUSR_NO# /*
			조사_자료_엑셀.수정자_번호 */
		</isNotEmpty>
<![CDATA[
		WHERE 1 = 1
		AND SRVY_NO = #SRVY_NO#::int /* 조사_자료_엑셀.조사_번호 */
]]>
	</update>

	<delete id="srvyDtaExcelDAO.deleteSrvyDtaExcel">
	<![CDATA[
		/* srvyDtaExcelDAO.deleteSrvyDtaExcel */
		/* 조사_자료_엑셀 삭제 */
		DELETE FROM TN_SRVY_DTA_EXCEL
		WHERE 1 = 1
		AND SRVY_NO = #SRVY_NO#::int /* 조사_자료_엑셀.조사_번호 */
	]]>
	</delete>

	<select id="srvyDtaExcelDAO.selectSrvyDtaExcel" resultClass="srvyDtaExcelVO">
	<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcel */
		/* 조사_자료_엑셀 조회 */
		SELECT
			tnsrvydtaexcel.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
			, tnsrvydtaexcel.FILE_NO /* 조사_자료_엑셀.파일_번호 */
			, tnsrvydtaexcel.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
			, tnsrvydtaexcel.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
			, tnsrvydtaexcel.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
			, tnsrvydtaexcel.TRACK /* 조사_자료_엑셀.차로 */
			, tnsrvydtaexcel.STRTPT /* 조사_자료_엑셀.시점 */
			, tnsrvydtaexcel.ENDPT /* 조사_자료_엑셀.종점 */
			, tnsrvydtaexcel.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
			, tnsrvydtaexcel.SRVY_NM /* 조사_자료_엑셀.조사_명 */
			, tnsrvydtaexcel.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
			, tnsrvydtaexcel.EVL_PROCESS_AT /* 조사_자료_엑셀.평가_처리_여부 */
			, tnsrvydtaexcel.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
			, tnsrvydtaexcel.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
			, tnsrvydtaexcel.PRDTMDL_PROCESS_AT /* 조사_자료_엑셀.예측모델_처리_여부 */
			, tnsrvydtaexcel.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
			, tnsrvydtaexcel.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
			, tnsrvydtaexcel.USE_AT /* 조사_자료_엑셀.사용_여부 */
			, tnsrvydtaexcel.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
			, tnsrvydtaexcel.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
			, tnsrvydtaexcel.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
			, tnsrvydtaexcel.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
		FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
		WHERE 1 = 1
		AND tnsrvydtaexcel.SRVY_NO = #SRVY_NO#::int /* 조사_자료_엑셀.조사_번호 */
]]>
	</select>

	<sql id="srvyDtaExcelDAO.selectSrvyDtaExcelList.where">
		WHERE 1 = 1

		<isEqual property="searchCondition" compareValue="0">
			AND
			tnsrvydtaexcel.SRVY_NO = #searchKeyword#::int
		</isEqual>
		<isEqual property="searchCondition" compareValue="1">
			AND
			tnsrvydtaexcel.FILE_NO LIKE '%' || #searchKeyword#::int || '%'
		</isEqual>
		<isNotEmpty property="SRVY_NO"><![CDATA[ /* 조사_자료_엑셀.조사_번호 */ AND tnsrvydtaexcel.SRVY_NO = #SRVY_NO#::int ]]></isNotEmpty>
		<isNotEmpty property="FILE_NO"><![CDATA[ /* 조사_자료_엑셀.파일_번호 */ AND tnsrvydtaexcel.FILE_NO = #FILE_NO#::int ]]></isNotEmpty>
		<isNotEmpty property="DATA_CO"><![CDATA[ /* 조사_자료_엑셀.데이터_건수 */ AND tnsrvydtaexcel.DATA_CO = #DATA_CO#::int ]]></isNotEmpty>
		<isNotEmpty property="ROUTE_CODE"><![CDATA[ /* 조사_자료_엑셀.노선_코드 */ AND tnsrvydtaexcel.ROUTE_CODE = #ROUTE_CODE# ]]></isNotEmpty>
		<isNotEmpty property="DIRECT_CODE"><![CDATA[ /* 조사_자료_엑셀.행선_코드 */ AND tnsrvydtaexcel.DIRECT_CODE = #DIRECT_CODE# ]]></isNotEmpty>
		<isNotEmpty property="TRACK"><![CDATA[ /* 조사_자료_엑셀.차로 */ AND tnsrvydtaexcel.TRACK = #TRACK# ]]></isNotEmpty>
		<isNotEmpty property="STRTPT"><![CDATA[ /* 조사_자료_엑셀.시점 */ AND tnsrvydtaexcel.STRTPT = #STRTPT#::int ]]></isNotEmpty>
		<isNotEmpty property="ENDPT"><![CDATA[ /* 조사_자료_엑셀.종점 */ AND tnsrvydtaexcel.ENDPT = #ENDPT#::int ]]></isNotEmpty>
		<isNotEmpty property="SRVY_DE"><![CDATA[ /* 조사_자료_엑셀.조사_일자 */ AND tnsrvydtaexcel.SRVY_DE = #SRVY_DE# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_NM"><![CDATA[ /* 조사_자료_엑셀.조사_명 */ AND tnsrvydtaexcel.SRVY_NM = #SRVY_NM# ]]></isNotEmpty>
		<isNotEmpty property="EXMNR_NM"><![CDATA[ /* 조사_자료_엑셀.조사자_명 */ AND tnsrvydtaexcel.EXMNR_NM = #EXMNR_NM# ]]></isNotEmpty>
		<isNotEmpty property="EVL_PROCESS_AT"><![CDATA[ /* 조사_자료_엑셀.평가_처리_여부 */ AND tnsrvydtaexcel.EVL_PROCESS_AT = #EVL_PROCESS_AT# ]]></isNotEmpty>
		<isNotEmpty property="GPS_CORTN_PROCESS_AT"><![CDATA[ /* 조사_자료_엑셀.GPS_보정_처리_여부 */ AND tnsrvydtaexcel.GPS_CORTN_PROCESS_AT =  #GPS_CORTN_PROCESS_AT#  ]]></isNotEmpty>
		<isNotEmpty property="SM_PROCESS_AT"><![CDATA[ /* 조사_자료_엑셀.집계_처리_여부 */ AND tnsrvydtaexcel.SM_PROCESS_AT = #SM_PROCESS_AT# ]]></isNotEmpty>
		<isNotEmpty property="PRDTMDL_PROCESS_AT"><![CDATA[ /* 조사_자료_엑셀.예측모델_처리_여부 */ AND tnsrvydtaexcel.PRDTMDL_PROCESS_AT = #PRDTMDL_PROCESS_AT# ]]></isNotEmpty>
		<isNotEmpty property="VAL_EVL_AT"><![CDATA[ /* 조사_자료_엑셀.유효성_평가_여부 */ AND tnsrvydtaexcel.VAL_EVL_AT = #VAL_EVL_AT# ]]></isNotEmpty>
		<isNotEmpty property="DELETE_AT"><![CDATA[ /* 조사_자료_엑셀.삭제_여부 */ AND tnsrvydtaexcel.DELETE_AT = #DELETE_AT# ]]></isNotEmpty>
		<isNotEmpty property="USE_AT"><![CDATA[ /* 조사_자료_엑셀.사용_여부 */ AND tnsrvydtaexcel.USE_AT = #USE_AT# ]]></isNotEmpty>
		<isNotEmpty property="CRTR_NO"><![CDATA[ /* 조사_자료_엑셀.생성자_번호 */ AND tnsrvydtaexcel.CRTR_NO = #CRTR_NO#::int ]]></isNotEmpty>
		<isNotEmpty property="CREAT_DT"><![CDATA[ /* 조사_자료_엑셀.생성_일시 */ AND tnsrvydtaexcel.CREAT_DT = #CREAT_DT# ]]></isNotEmpty>
		<isNotEmpty property="UPDUSR_NO"><![CDATA[ /* 조사_자료_엑셀.수정자_번호 */ AND tnsrvydtaexcel.UPDUSR_NO = #UPDUSR_NO# ]]></isNotEmpty>
		<isNotEmpty property="UPDT_DT"><![CDATA[ /* 조사_자료_엑셀.수정_일시 */ AND tnsrvydtaexcel.UPDT_DT = #UPDT_DT# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_NO_LIST">
		<![CDATA[ /* 조사_자료_엑셀.조사_번호 */  ]]>
			<iterate close="::numeric)" conjunction="::numeric," open="("
				prepend=" AND tnsrvydtaexcel.SRVY_NO IN " property="SRVY_NO_LIST">
				#SRVY_NO_LIST[]#
			</iterate>
		</isNotEmpty>


	</sql>

	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelListPage"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelListPage */
		/* 조사_자료_엑셀 조회(페이징) */
		WITH tnsrvydtaexcel AS
		(
		SELECT
				tnsrvydtaexcel.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
				, tnsrvydtaexcel.FILE_NO /* 조사_자료_엑셀.파일_번호 */
				, tnsrvydtaexcel.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
				, tnsrvydtaexcel.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
				, tnsrvydtaexcel.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
				, tnsrvydtaexcel.TRACK /* 조사_자료_엑셀.차로 */
				, tnsrvydtaexcel.STRTPT /* 조사_자료_엑셀.시점 */
				, tnsrvydtaexcel.ENDPT /* 조사_자료_엑셀.종점 */
				, tnsrvydtaexcel.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
				, tnsrvydtaexcel.SRVY_NM /* 조사_자료_엑셀.조사_명 */
				, tnsrvydtaexcel.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
				, tnsrvydtaexcel.EVL_PROCESS_AT /* 조사_자료_엑셀.평가_처리_여부 */
				, tnsrvydtaexcel.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
				, tnsrvydtaexcel.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
				, tnsrvydtaexcel.PRDTMDL_PROCESS_AT /* 조사_자료_엑셀.예측모델_처리_여부 */
				, tnsrvydtaexcel.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
				, tnsrvydtaexcel.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
				, tnsrvydtaexcel.USE_AT /* 조사_자료_엑셀.사용_여부 */
				, tnsrvydtaexcel.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
				, tnsrvydtaexcel.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
				, tnsrvydtaexcel.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
				, tnsrvydtaexcel.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
			FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
]]>
		WHERE 1 = 1

		<isEqual property="searchCondition" compareValue="0">
			AND
			tnsrvydtaexcel.SRVY_NO = #searchKeyword#::int
		</isEqual>

		<isEqual property="searchCondition" compareValue="1">
			AND
			tnsrvydtaexcel.FILE_NO LIKE '%' || #searchKeyword#::int || '%'
		</isEqual>

		<isNotEmpty property="SRVY_NO">
				<![CDATA[
					/* 조사_자료_엑셀.조사_번호 */
					AND tnsrvydtaexcel.SRVY_NO = #SRVY_NO#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="FILE_NO">
				<![CDATA[
					/* 조사_자료_엑셀.파일_번호 */
					AND tnsrvydtaexcel.FILE_NO = #FILE_NO#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="DATA_CO">
				<![CDATA[
					/* 조사_자료_엑셀.데이터_건수 */
					AND tnsrvydtaexcel.DATA_CO = #DATA_CO#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="ROUTE_CODE">
				<![CDATA[
					/* 조사_자료_엑셀.노선_코드 */
					AND tnsrvydtaexcel.ROUTE_CODE = #ROUTE_CODE#
				]]>
		</isNotEmpty>

		<isNotEmpty property="DIRECT_CODE">
				<![CDATA[
					/* 조사_자료_엑셀.행선_코드 */
					AND tnsrvydtaexcel.DIRECT_CODE = #DIRECT_CODE#
				]]>
		</isNotEmpty>

		<isNotEmpty property="TRACK">
				<![CDATA[
					/* 조사_자료_엑셀.차로 */
					AND tnsrvydtaexcel.TRACK = #TRACK#
				]]>
		</isNotEmpty>

		<isNotEmpty property="STRTPT">
				<![CDATA[
					/* 조사_자료_엑셀.시점 */
					AND tnsrvydtaexcel.STRTPT = #STRTPT#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="ENDPT">
				<![CDATA[
					/* 조사_자료_엑셀.종점 */
					AND tnsrvydtaexcel.ENDPT = #ENDPT#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="SRVY_DE">
				<![CDATA[
					/* 조사_자료_엑셀.조사_일자 */
					AND tnsrvydtaexcel.SRVY_DE = #SRVY_DE#
				]]>
		</isNotEmpty>

		<isNotEmpty property="SRVY_NM">
				<![CDATA[
					/* 조사_자료_엑셀.조사_명 */
					AND tnsrvydtaexcel.SRVY_NM = #SRVY_NM#
				]]>
		</isNotEmpty>

		<isNotEmpty property="EXMNR_NM">
				<![CDATA[
					/* 조사_자료_엑셀.조사자_명 */
					AND tnsrvydtaexcel.EXMNR_NM = #EXMNR_NM#
				]]>
		</isNotEmpty>

		<isNotEmpty property="EVL_PROCESS_AT">
				<![CDATA[
					/* 조사_자료_엑셀.평가_처리_여부 */
					AND tnsrvydtaexcel.EVL_PROCESS_AT = #EVL_PROCESS_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="GPS_CORTN_PROCESS_AT">
				<![CDATA[
					/* 조사_자료_엑셀.GPS_보정_처리_여부 */
					AND tnsrvydtaexcel.GPS_CORTN_PROCESS_AT =  #GPS_CORTN_PROCESS_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="SM_PROCESS_AT">
				<![CDATA[
					/* 조사_자료_엑셀.집계_처리_여부 */
					AND tnsrvydtaexcel.SM_PROCESS_AT = #SM_PROCESS_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="PRDTMDL_PROCESS_AT">
				<![CDATA[
					/* 조사_자료_엑셀.예측모델_처리_여부 */
					AND tnsrvydtaexcel.PRDTMDL_PROCESS_AT =  #PRDTMDL_PROCESS_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="VAL_EVL_AT">
				<![CDATA[
					/* 조사_자료_엑셀.유효성_평가_여부 */
					AND tnsrvydtaexcel.VAL_EVL_AT = #VAL_EVL_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="DELETE_AT">
				<![CDATA[
					/* 조사_자료_엑셀.삭제_여부 */
					AND tnsrvydtaexcel.DELETE_AT = #DELETE_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="USE_AT">
				<![CDATA[
					/* 조사_자료_엑셀.사용_여부 */
					AND tnsrvydtaexcel.USE_AT = #USE_AT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="CRTR_NO">
				<![CDATA[
					/* 조사_자료_엑셀.생성자_번호 */
					AND tnsrvydtaexcel.CRTR_NO = #CRTR_NO#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="CREAT_DT">
				<![CDATA[
					/* 조사_자료_엑셀.생성_일시 */
					AND tnsrvydtaexcel.CREAT_DT = #CREAT_DT#
				]]>
		</isNotEmpty>

		<isNotEmpty property="UPDUSR_NO">
				<![CDATA[
					/* 조사_자료_엑셀.수정자_번호 */
					AND tnsrvydtaexcel.UPDUSR_NO = #UPDUSR_NO#::int
				]]>
		</isNotEmpty>

		<isNotEmpty property="UPDT_DT">
				<![CDATA[
					/* 조사_자료_엑셀.수정_일시 */
					AND tnsrvydtaexcel.UPDT_DT = #UPDT_DT#
				]]>
		</isNotEmpty>
	<![CDATA[
		)
		SELECT tnsrvydtaexcel.* FROM
		(
		SELECT
										tnsrvydtaexcel.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
											, tnsrvydtaexcel.FILE_NO /* 조사_자료_엑셀.파일_번호 */
											, tnsrvydtaexcel.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
											, tnsrvydtaexcel.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
											, tnsrvydtaexcel.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
											, tnsrvydtaexcel.TRACK /* 조사_자료_엑셀.차로 */
											, tnsrvydtaexcel.STRTPT /* 조사_자료_엑셀.시점 */
											, tnsrvydtaexcel.ENDPT /* 조사_자료_엑셀.종점 */
											, tnsrvydtaexcel.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
											, tnsrvydtaexcel.SRVY_NM /* 조사_자료_엑셀.조사_명 */
											, tnsrvydtaexcel.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
											, tnsrvydtaexcel.EVL_PROCESS_AT /* 조사_자료_엑셀.평가_처리_여부 */
											, tnsrvydtaexcel.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
											, tnsrvydtaexcel.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
											, tnsrvydtaexcel.PRDTMDL_PROCESS_AT /* 조사_자료_엑셀.예측모델_처리_여부 */
											, tnsrvydtaexcel.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
											, tnsrvydtaexcel.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
											, tnsrvydtaexcel.USE_AT /* 조사_자료_엑셀.사용_여부 */
											, tnsrvydtaexcel.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
											, tnsrvydtaexcel.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
											, tnsrvydtaexcel.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
											, tnsrvydtaexcel.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
						/* 조사_자료_엑셀.조사_번호 */
			/* 조사_자료_엑셀.파일_번호 */
			, ROW_NUMBER() OVER( ORDER BY tnsrvydtaexcel.SRVY_NO ASC, tnsrvydtaexcel.FILE_NO DESC )  ROW_NO
			FROM  tnsrvydtaexcel
			WHERE 1=1
		)  tnsrvydtaexcel
		WHERE 1=1
]]>
<![CDATA[
  		AND  tnsrvydtaexcel.ROW_NO BETWEEN #firstIndex# + 1 AND #lastIndex#
]]>
<![CDATA[
		AND  tnsrvydtaexcel.ROW_NO <= #lastIndex#	AND  ROW_NO > #firstIndex#
]]>


	</select>


	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelList */
		/* 조사_자료_엑셀 조회 */
		SELECT * FROM (SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
			SELECT
				tnsrvydtaexcel.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
				, tnsrvydtaexcel.FILE_NO /* 조사_자료_엑셀.파일_번호 */
				, tnsrvydtaexcel.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
				, tnsrvydtaexcel.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
				, tnsrvydtaexcel.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
				, tnsrvydtaexcel.TRACK /* 조사_자료_엑셀.차로 */
				, tnsrvydtaexcel.STRTPT /* 조사_자료_엑셀.시점 */
				, tnsrvydtaexcel.ENDPT /* 조사_자료_엑셀.종점 */
				, tnsrvydtaexcel.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
				, tnsrvydtaexcel.SRVY_NM /* 조사_자료_엑셀.조사_명 */
				, tnsrvydtaexcel.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
				, tnsrvydtaexcel.EVL_PROCESS_AT /* 조사_자료_엑셀.평가_처리_여부 */
				, tnsrvydtaexcel.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
				, tnsrvydtaexcel.PRDTMDL_PROCESS_AT /* 조사_자료_엑셀.예측모델_처리_여부 */
				, tnsrvydtaexcel.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
				, tnsrvydtaexcel.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
				, tnsrvydtaexcel.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
				, tnsrvydtaexcel.USE_AT /* 조사_자료_엑셀.사용_여부 */
				, tnsrvydtaexcel.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
				, tnsrvydtaexcel.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
				, tnsrvydtaexcel.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
				, tnsrvydtaexcel.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
			FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
]]>
		<include refid="srvyDtaExcelDAO.selectSrvyDtaExcelList.where" />
<![CDATA[
		ORDER BY
				tnsrvydtaexcel.SRVY_NO DESC /* 조사_자료_엑셀.조사_번호 */
		) tb) tnsrvydtaexcel  WHERE 1=1
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    AND rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>


	</select>


	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelListTotalCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelListTotalCount */
		/* 조사_자료_엑셀 목록 개수 조회  */
		SELECT COUNT(*) AS totCnt
		FROM TN_SRVY_DTA tnsrvydta
]]>
		<include refid="srvyDtaExcelDAO.selectSrvyDtaExcelList.where" />
<![CDATA[
]]>
	</select>


	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelUploadResultList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelUploadResultList */
		/* 조사_자료_엑셀  파일 업로드 결과 조회  */
		SELECT * FROM (SELECT ROW_NUMBER() OVER( ORDER BY $sidx$ $sord$  ) rn, tb.* FROM (
			 SELECT TO_CHAR(tnsrvydtaexcel.CREAT_DT, 'YYYY-MM-DD') AS CREAT_DT
	     		 , SUM(CASE WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0002' THEN 1 ELSE 0 END ) AS SUCCESS_CNT
	     		 , SUM(CASE WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0003' THEN 1 ELSE 0 END ) AS FAIL_CNT
	     		 , tnsrvydtaexcel.CRTR_NO
	     		 , (SELECT tnsysuser.USER_NM FROM TN_SYS_USER tnsysuser WHERE tnsysuser.USER_NO = tnsrvydtaexcel.CRTR_NO and tnsysuser.USE_AT = 'Y' and tnsysuser.DELETE_AT = 'N') CRTR_NM
			FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel, TL_SRVY_DTA_LOG tlsrvydtalog
		   WHERE tnsrvydtaexcel.SRVY_NO = tlsrvydtalog.SRVY_NO
		   	 AND tnsrvydtaexcel.CRTR_NO = tlsrvydtalog.CRTR_NO
		   	 AND tnsrvydtaexcel.USE_AT = 'Y'
		   	 AND tnsrvydtaexcel.DELETE_AT = 'N'
		     AND tlsrvydtalog.PROCESS_SE = (SELECT MAX(tlsrvydtalog.PROCESS_SE) FROM TL_SRVY_DTA_LOG tlsrvydtalog WHERE tlsrvydtalog.SRVY_NO = tnsrvydtaexcel.SRVY_NO AND tlsrvydtalog.PROCESS_SE IN ('PCSE0001', 'PCSE0002'))
			GROUP BY TO_CHAR(tnsrvydtaexcel.CREAT_DT, 'YYYY-MM-DD'), tnsrvydtaexcel.CRTR_NO
		) tb) resultlist  WHERE 1=1
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    AND rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelUploadResultCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelUploadResultCount */
		/* 조사_자료_엑셀  파일 업로드 결과 개수 조회  */
		SELECT COUNT(*) FROM (
			 SELECT TO_CHAR(tnsrvydta.CREAT_DT, 'YYYY-MM-DD') AS CREAT_DT
			FROM TN_SRVY_DTA tnsrvydta
			   , TL_SRVY_DTA_LOG tlsrvydtalog
	      WHERE tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
	      	AND tnsrvydta.CRTR_NO = tlsrvydtalog.CRTR_NO
	      	AND tnsrvydta.USE_AT = 'Y'
		   	AND tnsrvydta.DELETE_AT = 'N'
	        AND tlsrvydtalog.PROCESS_SE = (SELECT MAX(tlsrvydtalog.PROCESS_SE) FROM TL_SRVY_DTA_LOG tlsrvydtalog WHERE tlsrvydtalog.SRVY_NO = tnsrvydtaexcel.SRVY_NO AND tlsrvydtalog.PROCESS_SE IN ('PCSE0001', 'PCSE0002'))
		  GROUP BY TO_CHAR(tnsrvydta.CREAT_DT, 'YYYY-MM-DD')
		)as sub_SrvyDta
]]>
	</select>


	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelUploadFileList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelUploadFileList */
		/* 조사_자료_엑셀  파일 업로드 결과 상세 조회  */
		SELECT * FROM (
			 SELECT ROW_NUMBER() OVER( ORDER BY tnsrvydtaexcel.SRVY_NO ASC, tnsrvydtaexcel.FILE_NO DESC ) RN
			 	   , (SELECT tnattachfile.ORGINL_FILE_NM FROM TN_ATTACH_FILE tnattachfile WHERE tnattachfile.FILE_NO = tnsrvydtaexcel.FILE_NO) FILE_NM
			       , tnsrvydtaexcel.CREAT_DT
			       , (SELECT tnsysuser.USER_NM FROM TN_SYS_USER tnsysuser WHERE tnsysuser.USER_NO = tnsrvydtaexcel.CRTR_NO) USER_NM
			       , tlsrvydtalog.LOG_MSSAGE
			   FROM TN_SRVY_DTA tnsrvydta, TL_SRVY_DTA_LOG tlsrvydtalog
			  WHERE tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
			  	AND tnsrvydta.CRTR_NO = tlsrvydtalog.CRTR_NO
			 	AND tnsrvydta.USE_AT = 'Y'
		   	 	AND tnsrvydta.DELETE_AT = 'N'
			 	AND tlsrvydtalog.PROCESS_SE = (SELECT MAX(tlsrvydtalog.PROCESS_SE) FROM TL_SRVY_DTA_LOG tlsrvydtalog WHERE tlsrvydtalog.SRVY_NO = tnsrvydta.SRVY_NO AND tlsrvydtalog.PROCESS_SE IN ('PCSE0001', 'PCSE0002'))
			 	AND tlsrvydtalog.PROCESS_STTUS = #PROCESS_STTUS#
			 	AND TO_CHAR(tnsrvydta.CREAT_DT, 'YYYY-MM-DD') = TO_CHAR(cast(#CREAT_DT# as date), 'YYYY-MM-DD')
			 	AND tnsrvydta.CRTR_NO = #CRTR_NO#::int
		) tnsrvydta WHERE 1=1
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    AND rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaExcelUploadFileCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaExcelUploadFileCount */
		/* 조사_자료_엑셀  파일 업로드 결과 상세 조회 개수  */
		SELECT COUNT(*) totCnt
	      FROM TN_SRVY_DTA tnsrvydta
	      	 , TL_SRVY_DTA_LOG tlsrvydtalog
	     WHERE tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
	       AND tnsrvydta.CRTR_NO = tlsrvydtalog.CRTR_NO
	       AND tnsrvydta.USE_AT = 'Y'
		   AND tnsrvydta.DELETE_AT = 'N'
		   AND tlsrvydtalog.PROCESS_SE = (SELECT MAX(tlsrvydtalog.PROCESS_SE) FROM TL_SRVY_DTA_LOG tlsrvydtalog WHERE tlsrvydtalog.SRVY_NO = tnsrvydta.SRVY_NO AND tlsrvydtalog.PROCESS_SE IN ('PCSE0001', 'PCSE0002'))
	 	   AND tlsrvydtalog.PROCESS_STTUS = #PROCESS_STTUS#
	 	   AND TO_CHAR(tnsrvydta.CREAT_DT, 'YYYY-MM-DD') = TO_CHAR(cast(#CREAT_DT# as date), 'YYYY-MM-DD')
	 	   AND tnsrvydta.CRTR_NO = #CRTR_NO#::int
]]>
	</select>


	<select id="srvyDtaExcelDAO.selectSrvyDtaCompList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
			/* srvyDtaExcelDAO.selectSrvyDtaCompList */
			/* 조사_자료 등록 대상 목록  */
			SELECT * FROM (
				SELECT ROW_NUMBER() OVER(ORDER BY $sidx$ $sord$) RN, tb.* FROM (
					SELECT    tnattachfile.ORGINL_FILE_NM FILE_NM
					        , tnsrvydtaexcel.DATA_CO
							, tnsrvydtaexcel.CREAT_DT
                            , tnsrvydtaexcel.SRVY_DE
							, tnsysuser.USER_NM
							, tnsrvydtaexcel.FILE_NO
							, tnsrvydtaexcel.SRVY_NO
					        , COALESCE((
                               SELECT CASE 
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0002' THEN '성공'
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0003' THEN '실패'
		                              END FROM(
                                  SELECT ROW_NUMBER() OVER(PARTITION BY SRVY_NO ORDER BY END_DT DESC) RN,
                                         PROCESS_SE, PROCESS_STTUS, SRVY_NO
                                  FROM TL_SRVY_DTA_LOG
                                  WHERE PROCESS_SE = 'PCSE0003'
                              ) tlsrvydtalog
                              WHERE tlsrvydtalog.RN = 1
                              AND tlsrvydtalog.SRVY_NO = tnsrvydtaexcel.SRVY_NO
                              ), '미평가') EVL_PROCESS
                            , COALESCE((
                               SELECT CASE 
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0002' THEN '성공'
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0003' THEN '실패'
		                              END FROM(
                                  SELECT ROW_NUMBER() OVER(PARTITION BY SRVY_NO ORDER BY END_DT DESC) RN,
                                        PROCESS_SE, PROCESS_STTUS, SRVY_NO
                                  FROM TL_SRVY_DTA_LOG
                                  WHERE PROCESS_SE = 'PCSE0007'
                              ) tlsrvydtalog
                              WHERE tlsrvydtalog.RN = 1
                              AND tlsrvydtalog.SRVY_NO = tnsrvydtaexcel.SRVY_NO
                              ), '미평가') GPS_CORTN_PROCESS
                            , COALESCE((
                               SELECT CASE 
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0002' THEN '성공'
		                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0003' THEN '실패'
		                              END FROM(
                                  SELECT ROW_NUMBER() OVER(PARTITION BY SRVY_NO ORDER BY END_DT DESC) RN,
                                        PROCESS_SE, PROCESS_STTUS, SRVY_NO
                                  FROM TL_SRVY_DTA_LOG
                                  WHERE PROCESS_SE = 'PCSE0004'
                              ) tlsrvydtalog
                              WHERE tlsrvydtalog.RN = 1
                              AND tlsrvydtalog.SRVY_NO = tnsrvydtaexcel.SRVY_NO
                              ), '미평가') SM_PROCESS
                             , TO_CHAR(NOW(), 'YYYY') EVL_YEAR
					  FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel,
                            TN_ATTACH_FILE tnattachfile,
                            TN_SYS_USER tnsysuser
					  WHERE tnsrvydtaexcel.FILE_NO = tnattachfile.FILE_NO
	                    AND tnattachfile.USE_AT = 'Y'
	                    AND tnattachfile.DELETE_AT = 'N'
	                    AND tnsrvydtaexcel.CRTR_NO = tnsysuser.USER_NO
	                    AND tnsysuser.USE_AT = 'Y'
	                    AND tnsysuser.DELETE_AT = 'N'
	                    AND (
	                     		 tnsrvydtaexcel.EVL_PROCESS_AT = 'N'
							  	 OR tnsrvydtaexcel.GPS_CORTN_PROCESS_AT = 'N'
							   	 OR tnsrvydtaexcel.SM_PROCESS_AT = 'N'
							  )
						AND tnsrvydtaexcel.VAL_EVL_AT = 'Y'
						AND tnsrvydtaexcel.USE_AT = 'Y'
						AND tnsrvydtaexcel.DELETE_AT = 'N'
			  	 ) tb
			 ) tnsrvydtaexcel where 1=1
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    AND rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaCompCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaCompCount */
		/* 조사_자료 등록 대상 목록 갯수  */
		SELECT COUNT(*) totCnt
		  FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
		 WHERE (tnsrvydtaexcel.EVL_PROCESS_AT = 'N'
		    OR tnsrvydtaexcel.GPS_CORTN_PROCESS_AT = 'N'
		    OR tnsrvydtaexcel.SM_PROCESS_AT = 'N')
		   AND tnsrvydtaexcel.VAL_EVL_AT = 'Y'
		   AND tnsrvydtaexcel.USE_AT = 'Y'
		   AND tnsrvydtaexcel.DELETE_AT = 'N'
]]>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaSrvyNoList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaSrvyNoList */
		/* 조사_자료 등록 대상 엑셀별 목록  */
		SELECT COUNT(*) OVER () DATA_CO
	         , tnsrvydtaexcel.SRVY_NO
	         , tnattachfile.ORGINL_FILE_NM FILE_NM
	         , tnsrvydtaexcel.EVL_PROCESS_AT
	         , tnsrvydtaexcel.GPS_CORTN_PROCESS_AT
	         , tnsrvydtaexcel.SM_PROCESS_AT
		  FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
	         , TN_ATTACH_FILE tnattachfile
		 WHERE tnsrvydtaexcel.FILE_NO = tnattachfile.FILE_NO
           AND tnattachfile.USE_AT = 'Y'
           AND tnattachfile.DELETE_AT = 'N'
           AND (
           			tnsrvydtaexcel.EVL_PROCESS_AT = 'N'
		    	 OR tnsrvydtaexcel.GPS_CORTN_PROCESS_AT = 'N'
		    	 OR tnsrvydtaexcel.SM_PROCESS_AT = 'N'
		    	)
		   AND tnsrvydtaexcel.VAL_EVL_AT = 'Y'
		   AND tnsrvydtaexcel.USE_AT = 'Y'
		   AND tnsrvydtaexcel.DELETE_AT = 'N'
		   ]]>
		<isNotEmpty property="SRVY_NO_LIST">
		<![CDATA[ /* 조사_자료_엑셀.조사_번호 */  ]]>
			<iterate close=")" conjunction="," open="("
				prepend=" AND tnsrvydtaexcel.SRVY_NO IN " property="SRVY_NO_LIST">
				#SRVY_NO_LIST[]#
			</iterate>
		</isNotEmpty>
		<![CDATA[
	     ORDER BY
					tnsrvydtaexcel.SRVY_NO DESC
]]>
	</select>


	<select id="srvyDtaExcelDAO.srvyDtaExcelListExcelDownload" parameterClass="srvyDtaExcelVO"
		resultClass="hashMap">
<![CDATA[
		/* srvyDtaExcelDAO.srvyDtaExcelListExcelDownload */
		/* 조사_자료 목록 엑셀 다운로드 */
		SELECT * FROM (
		SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
		SELECT DISTINCT
		tnsrvydtaexcel.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
		, tnsrvydtaexcel.FILE_NO /* 조사_자료_엑셀.파일_번호 */
		, (SELECT tnattachfile.ORGINL_FILE_NM
		FROM TN_ATTACH_FILE
		tnattachfile
		WHERE tnattachfile.FILE_NO = tnsrvydtaexcel.FILE_NO) AS
		FILE_NM/*공통첨부파일.파일명*/
		, tnsrvydtaexcel.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
		, tnsrvydtaexcel.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
		, tnsrvydtaexcel.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
		, tnsrvydtaexcel.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
		, tnsrvydtaexcel.ROUTE_CODE
		, (SELECT CODE_NM FROM TC_CODE tccode WHERE tccode.CODE_VAL =
		tlsrvydtalog.PROCESS_STTUS) AS PROCESS_STTUS
		, CASE WHEN tnsrvydtaexcel.EVL_PROCESS_AT = 'Y'/*조사_자료_엑셀.평가_처리_여부*/
		AND tnsrvydtaexcel.GPS_CORTN_PROCESS_AT = 'Y'/* 조사_자료_엑셀.GPS_보정_처리_여부
		*/
		AND tnsrvydtaexcel.SM_PROCESS_AT = 'Y'/* 조사_자료_엑셀.집계_처리_여부 */
		THEN 'Y'
		ELSE 'N'
		END EVL_PROCESS_AT
		FROM TN_SRVY_DTA_EXCEL tnsrvydtaexcel
		LEFT OUTER JOIN TL_SRVY_DTA_LOG tlsrvydtalog ON tnsrvydtaexcel.SRVY_NO =
		tlsrvydtalog.SRVY_NO
		WHERE tnsrvydtaexcel.USE_AT = 'Y' AND tnsrvydtaexcel.DELETE_AT = 'N' ORDER
		BY CREAT_DT desc ) tb
		WHERE PROCESS_STTUS ='완료' /* 최소_구간_조사_자료.조사_기간 */
	]]>
		<isNotEmpty property="ROAD_NO"><![CDATA[ /* 조사_자료_엑셀.노선_코드 */ AND tb.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="SCH_SRVY_DE1"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND SRVY_DE >= #SCH_SRVY_DE1# ]]></isNotEmpty>
		<isNotEmpty property="SCH_SRVY_DE2"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND SRVY_DE <= #SCH_SRVY_DE2# ]]></isNotEmpty>

		<![CDATA[
		) as sub_tb
		]]>
	</select>

	<select id="srvyDtaExcelDAO.srvyDtaExcelList" parameterClass="srvyDtaExcelVO"
		resultClass="srvyDtaExcelVO">
<![CDATA[
			/* srvyDtaExcelDAO.srvyDtaExcelList */
			/* 조사_자료 목록  */
			SELECT * FROM (
				SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
					SELECT DISTINCT
					tnsrvydta.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
					, tnsrvydta.FILE_NO /* 조사_자료_엑셀.파일_번호 */
					, tnsrvydta.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
					, tnsrvydta.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
					, tnsrvydta.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
					, tnsrvydta.TRACK /* 조사_자료_엑셀.차로 */
					, tnsrvydta.STRTPT /* 조사_자료_엑셀.시점 */
					, tnsrvydta.ENDPT /* 조사_자료_엑셀.종점 */
					, tnsrvydta.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
					, tnsrvydta.SRVY_NM /* 조사_자료_엑셀.조사_명 */
					, tnsrvydta.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
				  /*, tnsrvydta.EVL_PROCESS_AT 조사_자료_엑셀.평가_처리_여부 */
					, tnsrvydta.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
					, tnsrvydta.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
					, tnsrvydta.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
					, tnsrvydta.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
					, tnsrvydta.USE_AT /* 조사_자료_엑셀.사용_여부 */
					, tnsrvydta.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
					, tnsrvydta.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
					, tnsrvydta.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
					, tnsrvydta.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
					, (SELECT tnattachfile.ORGINL_FILE_NM FROM TN_ATTACH_FILE  tnattachfile WHERE tnattachfile.FILE_NO = tnsrvydta.FILE_NO) AS FILE_NM/*공통첨부파일.파일명*/
		            , (SELECT CODE_NM FROM TC_CODE  tccode WHERE tccode.CODE_VAL = tlsrvydtalog.PROCESS_STTUS) AS PROCESS_STTUS
		            , CASE
		                WHEN  tnsrvydta.EVL_PROCESS_AT = 'Y'/*조사_자료_엑셀.평가_처리_여부*/
		                		AND tnsrvydta.GPS_CORTN_PROCESS_AT = 'Y'/* 조사_자료_엑셀.GPS_보정_처리_여부 */
		                      	AND tnsrvydta.SM_PROCESS_AT = 'Y'/* 조사_자료_엑셀.집계_처리_여부 */
			              THEN 'Y'
			            ELSE 'N'
		             	END EVL_PROCESS_AT
				FROM TN_SRVY_DTA tnsrvydta LEFT OUTER JOIN  TL_SRVY_DTA_LOG tlsrvydtalog ON tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
			WHERE tnsrvydta.USE_AT = 'Y' AND tnsrvydta.DELETE_AT = 'N'
]]>
		<isNotEmpty property="orderByColumn">
			ORDER BY $orderByColumn$ $orderByType$
		</isNotEmpty>
		) tb
		WHERE PROCESS_STTUS ='완료'
		<isNotEmpty property="ROAD_NO"><![CDATA[ /* 조사_자료_엑셀.노선_코드 */ AND tb.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_DE"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND  TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') = #SRVY_DE# ]]></isNotEmpty>
		<isEmpty property="SRVY_DE"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') >= #SCH_SRVY_DE1#
   																AND TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') <= #SCH_SRVY_DE2#]]></isEmpty>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    )as sub_srvyDtaExcelList
     WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>
	</select>

	<select id="srvyDtaExcelDAO.srvyDtaExcelListCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.srvyDtaExcelListCount */
		/* 조사_자료  목록 갯수  */
			SELECT COUNT(*) FROM (
					SELECT DISTINCT
					tnsrvydta.SRVY_NO /* 조사_자료_엑셀.조사_번호 */
					, tnsrvydta.FILE_NO /* 조사_자료_엑셀.파일_번호 */
					, tnsrvydta.DATA_CO /* 조사_자료_엑셀.데이터_건수 */
					, tnsrvydta.ROUTE_CODE /* 조사_자료_엑셀.노선_코드 */
					, tnsrvydta.DIRECT_CODE /* 조사_자료_엑셀.행선_코드 */
					, tnsrvydta.TRACK /* 조사_자료_엑셀.차로 */
					, tnsrvydta.STRTPT /* 조사_자료_엑셀.시점 */
					, tnsrvydta.ENDPT /* 조사_자료_엑셀.종점 */
					, tnsrvydta.SRVY_DE /* 조사_자료_엑셀.조사_일자 */
					, tnsrvydta.SRVY_NM /* 조사_자료_엑셀.조사_명 */
					, tnsrvydta.EXMNR_NM /* 조사_자료_엑셀.조사자_명 */
				  /*, tnsrvydta.EVL_PROCESS_AT 조사_자료_엑셀.평가_처리_여부 */
					, tnsrvydta.GPS_CORTN_PROCESS_AT /* 조사_자료_엑셀.GPS_보정_처리_여부 */
					, tnsrvydta.SM_PROCESS_AT /* 조사_자료_엑셀.집계_처리_여부 */
					, tnsrvydta.VAL_EVL_AT /* 조사_자료_엑셀.유효성_평가_여부 */
					, tnsrvydta.DELETE_AT /* 조사_자료_엑셀.삭제_여부 */
					, tnsrvydta.USE_AT /* 조사_자료_엑셀.사용_여부 */
					, tnsrvydta.CRTR_NO /* 조사_자료_엑셀.생성자_번호 */
					, tnsrvydta.CREAT_DT /* 조사_자료_엑셀.생성_일시 */
					, tnsrvydta.UPDUSR_NO /* 조사_자료_엑셀.수정자_번호 */
					, tnsrvydta.UPDT_DT /* 조사_자료_엑셀.수정_일시 */
					, (SELECT tnattachfile.ORGINL_FILE_NM FROM TN_ATTACH_FILE  tnattachfile WHERE tnattachfile.FILE_NO = tnsrvydta.FILE_NO) AS FILE_NM/*공통첨부파일.파일명*/
		            , (SELECT CODE_NM FROM TC_CODE  tccode WHERE tccode.CODE_VAL = tlsrvydtalog.PROCESS_STTUS) AS PROCESS_STTUS
		            , CASE
		                WHEN  tnsrvydta.EVL_PROCESS_AT = 'Y'/*조사_자료_엑셀.평가_처리_여부*/
		                		AND tnsrvydta.GPS_CORTN_PROCESS_AT = 'Y'/* 조사_자료_엑셀.GPS_보정_처리_여부 */
		                      	AND tnsrvydta.SM_PROCESS_AT = 'Y'/* 조사_자료_엑셀.집계_처리_여부 */
			              THEN 'Y'
			            ELSE 'N'
		             	END EVL_PROCESS_AT
			FROM TN_SRVY_DTA tnsrvydta LEFT OUTER JOIN  TL_SRVY_DTA_LOG tlsrvydtalog ON tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
		WHERE tnsrvydta.USE_AT = 'Y' AND tnsrvydta.DELETE_AT = 'N'
		  	 ) tb
		 WHERE PROCESS_STTUS ='완료'
]]>
		<isNotEmpty property="ROAD_NO"><![CDATA[ /* 조사_자료_엑셀.노선_코드 */ AND  tb.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_DE"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND  TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') = #SRVY_DE# ]]></isNotEmpty>
		<isEmpty property="SRVY_DE"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') >= #SCH_SRVY_DE1#
   																AND TO_CHAR(SRVY_DE::timestamp,'YYYY-MM-DD') <= #SCH_SRVY_DE2#]]></isEmpty>
	</select>

	<select id="srvyDtaExcelDAO.searchCreatDt" parameterClass="srvyDtaExcelVO"
		resultClass="srvyDtaExcelVO">
		<![CDATA[
				/* srvyDtaExcelDAO.searchCreatDt */
				/* 조사_자료_엑셀 등록일자를 조회한다. */
			SELECT SRVY_DE FROM (
				SELECT ROW_NUMBER() OVER() AS rn, tb.* FROM (
					SELECT DISTINCT
					   to_char(tnsrvydta.SRVY_DE::timestamp,'YYYY-MM-DD') AS SRVY_DE /* 조사_자료_엑셀.조사_일시 */
		            , (SELECT CODE_NM FROM TC_CODE  tccode WHERE tccode.CODE_VAL = tlsrvydtalog.PROCESS_STTUS) AS PROCESS_STTUS
		            , SRVY_NM
		            , tnsrvydta.ROUTE_CODE
				FROM TN_SRVY_DTA tnsrvydta LEFT OUTER JOIN  TL_SRVY_DTA_LOG tlsrvydtalog ON tnsrvydta.SRVY_NO = tlsrvydtalog.SRVY_NO
			WHERE tnsrvydta.USE_AT = 'Y' AND tnsrvydta.DELETE_AT = 'N'
		]]>
		) tb
		WHERE PROCESS_STTUS ='완료'
		<isNotEmpty property="ROAD_NO"><![CDATA[ /* 조사_자료_엑셀.노선_코드 */ AND tb.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="SCH_SRVY_DE1"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND SRVY_DE >= #SCH_SRVY_DE1# ]]></isNotEmpty>
		<isNotEmpty property="SCH_SRVY_DE2"><![CDATA[ /* 최소_구간_조사_자료.조사_기간 */ AND SRVY_DE <= #SCH_SRVY_DE2# ]]></isNotEmpty>
		)as sub_searchCreatDt
		GROUP BY SRVY_DE ORDER BY SRVY_DE DESC
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaPredctList"
		parameterClass="srvyDtaExcelVO" resultClass="srvyDtaExcelVO">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaPredctList */
		/* 조사_자료_예측 대상 조회 */
		SELECT * FROM (SELECT ROW_NUMBER() OVER(ORDER BY $sidx$ $sord$) RN, tb.* FROM (
			SELECT tnsrvydta.SRVY_NO
			     , tnattachfile.ORGINL_FILE_NM FILE_NM
			     , concat(SUBSTR(tnsrvydta.SRVY_DE, 1, 4), '년 ', SUBSTR(tnsrvydta.SRVY_DE, 5, 2), '월') SRVY_DE
			     , TO_CHAR(NOW(), 'YYYY') || '년 ' || TO_CHAR(NOW(), 'MM') || '월' CALC_DE
			     , to_char(now()::timestamp + '12 month', 'YYYY') || '~' || to_char(now()::timestamp + '120 month', 'YYYY') PREDCT_DE
			     , tnsrvydta.DATA_CO
			     , COALESCE((
			           SELECT CASE 
                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0002' THEN '성공'
                               	WHEN tlsrvydtalog.PROCESS_STTUS = 'PCST0003' THEN '실패'
                              END FROM(
			              SELECT ROW_NUMBER() OVER(PARTITION BY SRVY_NO ORDER BY END_DT DESC) RN,
			                    PROCESS_SE, PROCESS_STTUS, SRVY_NO
			              FROM TL_SRVY_DTA_LOG
			              WHERE PROCESS_SE = 'PCSE0008'
			          ) tlsrvydtalog
			          WHERE tlsrvydtalog.RN = 1
			          AND tlsrvydtalog.SRVY_NO = tnsrvydta.SRVY_NO
			          ), '미평가') PRDTMDL_PROCESS
			  FROM TN_SRVY_DTA tnsrvydta
			  LEFT OUTER JOIN TN_ATTACH_FILE tnattachfile
			    ON tnattachfile.FILE_NO = tnsrvydta.FILE_NO
			   AND tnattachfile.USE_AT = 'Y'
			   AND tnattachfile.DELETE_AT = 'N'
			 WHERE tnsrvydta.USE_AT = 'Y'
			   AND tnsrvydta.DELETE_AT = 'N'
			   AND tnsrvydta.PRDTMDL_PROCESS_AT = 'N'
			   AND tnsrvydta.VAL_EVL_AT = 'Y'
			   AND tnsrvydta.EVL_PROCESS_AT = 'Y'
			   AND tnsrvydta.GPS_CORTN_PROCESS_AT = 'Y'
			   AND tnsrvydta.SM_PROCESS_AT = 'Y'
		) tb) tnsrvydta  WHERE 1=1
]]>
		<isEqual prepend=" " property="usePage" compareValue="true">
<![CDATA[
    AND rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
]]>
		</isEqual>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaPredctListTotalCount"
		parameterClass="srvyDtaExcelVO" resultClass="int">
<![CDATA[
		/* srvyDtaExcelDAO.selectSrvyDtaPredctListTotalCount */
		/* 조사_자료_예측 대상 조회 목록 갯수  */
		SELECT COUNT(*) totCnt
		  FROM TN_SRVY_DTA tnsrvydta
		 WHERE tnsrvydta.USE_AT = 'Y'
		   AND tnsrvydta.DELETE_AT = 'N'
		   AND tnsrvydta.PRDTMDL_PROCESS_AT = 'N'
		   AND tnsrvydta.VAL_EVL_AT = 'Y'
		   AND tnsrvydta.EVL_PROCESS_AT = 'Y'
		   AND tnsrvydta.GPS_CORTN_PROCESS_AT = 'Y'
		   AND tnsrvydta.SM_PROCESS_AT = 'Y'
]]>
	</select>

	<select id="srvyDtaExcelDAO.selectSrvyDtaEvlInfoListExcel" parameterClass="mummSctnSrvyDtaVO" resultClass="hashMap">
    <![CDATA[
	/* srvyDtaExcelDAO.selectSrvyDtaEvlInfoListExcel */
	/* 포장상태 평가정보.상세정보 목록 조회_엑셀_저장 */
    SELECT tnsmdtagnlsttus.*
    FROM (
		SELECT  tb.*
		FROM (
            SELECT
				tnsmdtagnlsttus.SRVY_NO /* 최소_구간_조사_자료.조사번호 */
				, concat(tnsmdtagnlsttus.SRVY_YEAR, '.', tnsmdtagnlsttus.SRVY_MT) AS		SRVY_DE /* 최소_구간_조사_자료.조사월 */
				, ( SELECT tcdept.LOWEST_DEPT_NM
	                FROM TC_DEPT tcdept
	                WHERE tcdept.DEPT_CODE = sect.DEPT_CODE::text ) AS DEPT_CODE /* 셀.부서코드 */
				, ( SELECT code.CODE_NM
	                FROM TC_CODE code
	                WHERE code.CODE_VAL = sect.ROAD_GRAD ) AS ROAD_GRAD /* 셀.도로등급 */
				, CASE 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'AC' THEN '거북등균열' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'BC' THEN '블럭균열' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'LC' THEN '선형균열' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'PTCHG' THEN '패칭' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'POTHOLE' THEN '포트홀' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'RD' THEN '소성변형' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'RCI' THEN '종단평탄성' 
				    WHEN (SELECT tccode.CODE_NM FROM TC_CODE tccode
						 WHERE tccode.CODE_VAL = tnsmdtagnlsttus.CNTL_DFECT ) = 'IRI' THEN '종단평탄성' 
				  END AS CR
		        , CASE WHEN DMG_CUZ_CLMT > DMG_CUZ_VMTC  AND DMG_CUZ_CLMT > DMG_CUZ_ETC THEN '기후'
			           WHEN DMG_CUZ_VMTC > DMG_CUZ_CLMT  AND DMG_CUZ_VMTC > DMG_CUZ_ETC THEN '교통량/하부불량'
			           WHEN DMG_CUZ_ETC > DMG_CUZ_CLMT AND DMG_CUZ_VMTC < DMG_CUZ_ETC THEN '기타'
			           WHEN DMG_CUZ_ETC = DMG_CUZ_VMTC AND DMG_CUZ_CLMT > DMG_CUZ_ETC THEN '교통량/하부불량, 기후'
			           WHEN DMG_CUZ_ETC = DMG_CUZ_CLMT AND DMG_CUZ_CLMT > DMG_CUZ_VMTC THEN '기후, 기타'
			           WHEN DMG_CUZ_ETC = DMG_CUZ_VMTC AND DMG_CUZ_VMTC > DMG_CUZ_CLMT THEN '교통량/하부불량, 기타'
			           WHEN DMG_CUZ_VMTC = DMG_CUZ_CLMT AND DMG_CUZ_VMTC = DMG_CUZ_ETC AND DMG_CUZ_ETC = 0 THEN '파손없슴'
			           WHEN DMG_CUZ_VMTC = DMG_CUZ_CLMT AND DMG_CUZ_VMTC = DMG_CUZ_ETC AND DMG_CUZ_ETC != 0 THEN '교통량/하부불량,기후,기타'
	               END
	            AS CUZ
				, sect.ADM_CODE /* 셀.행정구역코드 */
				, tnsmdtagnlsttus.ROUTE_CODE::int AS ROAD_NO_VAL
				, tnrouteinfo.ROAD_NAME AS ROAD_NM
				, CASE tnsmdtagnlsttus.DIRECT_CODE
						WHEN 'S' THEN '상행'
						WHEN 'E' THEN '하행'
						WHEN 'SE' THEN '상하행'
						ELSE ''
	               END AS DIRECT_CODE /* 최소_구간_조사_자료.행선 */
				, tnsmdtagnlsttus.TRACK /* 최소_구간_조사_자료.차로 */
				, tnsmdtagnlsttus.STRTPT/1000 AS STRTPT /* 최소_구간_조사_자료.시점 */
				, tnsmdtagnlsttus.ENDPT/1000 AS ENDPT/* 최소_구간_조사_자료.종점 */
				, ROUND(tnsmdtagnlsttus.GPCI, 2) AS GPCI /* 최소_구간_조사_자료.GPCI */
            FROM TN_SM_DTA_GNL_STTUS tnsmdtagnlsttus
				INNER JOIN CELL_SECT sect ON sect.ROUTE_CODE = tnsmdtagnlsttus.ROUTE_CODE
				AND sect.DIRECT_CODE = tnsmdtagnlsttus.DIRECT_CODE
				AND sect.TRACK = tnsmdtagnlsttus.TRACK
				AND	sect.STRTPT = tnsmdtagnlsttus.STRTPT
				AND sect.ENDPT = tnsmdtagnlsttus.ENDPT
                LEFT OUTER JOIN TN_ROUTE_INFO tnrouteinfo ON tnrouteinfo.ROAD_NO = tnsmdtagnlsttus.ROUTE_CODE
            WHERE 1=1
				AND	tnsmdtagnlsttus.USE_AT = 'Y'
				AND tnsmdtagnlsttus.DELETE_AT = 'N'
			]]>
        <isNotEmpty property="CELL_ID"><![CDATA[ AND sect.OBJECT_ID = #OBJECT_ID# ]]></isNotEmpty>
        <isNotEmpty property="DEPT_CODE"><![CDATA[ AND sect.DEPT_CODE = #DEPT_CODE# ]]></isNotEmpty>
        <isNotEmpty property="ROAD_GRAD"><![CDATA[ AND sect.ROAD_GRAD = #ROAD_GRAD# ]]></isNotEmpty>
        <isNotEmpty property="SRVY_YEAR"><![CDATA[ AND tnsmdtagnlsttus.SRVY_YEAR = #SRVY_YEAR# ]]></isNotEmpty>
        <isNotEmpty property="ROAD_NO"><![CDATA[ AND tnsmdtagnlsttus.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
        <isNotEmpty property="DIRECT_CODE"><![CDATA[ AND tnsmdtagnlsttus.DIRECT_CODE = #DIRECT_CODE# ]]></isNotEmpty>
        <isNotEmpty property="TRACK"><![CDATA[ AND tnsmdtagnlsttus.TRACK = #TRACK# ]]></isNotEmpty>
        <isNotEmpty property="STRTPT"><![CDATA[ AND tnsmdtagnlsttus.STRTPT >= #STRTPT#::int ]]></isNotEmpty>
        <isNotEmpty property="ENDPT"><![CDATA[ AND tnsmdtagnlsttus.ENDPT <= #ENDPT#::int ]]></isNotEmpty>
        <isNotEmpty property="CNTL_DFECT"><![CDATA[ AND tnsmdtagnlsttus.CNTL_DFECT = #CNTL_DFECT# ]]></isNotEmpty>
        <isNotEmpty property="MINGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI >= #MINGPCI# ]]></isNotEmpty>
        <isNotEmpty property="MAXGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI <= #MAXGPCI# ]]></isNotEmpty>
    <![CDATA[
			) tb
			ORDER BY $orderByColumn$ $orderByType$
		) tnsmdtagnlsttus
    WHERE 1=1
    ]]>
	</select>


	<select id="srvyDtaExcelDAO.srvyDtaEvlInfoDetailList" parameterClass="mummSctnSrvyDtaVO" resultClass="mummSctnSrvyDtaVO">
    <![CDATA[
        /* srvyDtaExcelDAO.srvyDtaEvlInfoDetailList */
        /* JOY_포장상태 평가정보.상세정보 목록 조회 */
        SELECT tnsmdtagnlsttus.* 
FROM   (SELECT Row_number() 
                 over() AS rn, 
               tb.* 
        FROM   (SELECT tnsmdtagnlsttus.srvy_no 
                       /* 최소_구간_조사_자료.조사번호 */, 
                       sect.object_id, 
                       sect.cell_id, 
                       tnsmdtagnlsttus.sm_no, 
                       Concat(tnsmdtagnlsttus.srvy_year, '.', 
                       tnsmdtagnlsttus.srvy_mt) 
                       AS 
                               SRVY_DE 
                       /* 최소_구간_조사_자료.조사월 */, 
                       tnsmdtagnlsttus.srvy_year, 
                       (SELECT tcdept.lowest_dept_nm 
                        FROM   tc_dept tcdept 
                        WHERE  tcdept.dept_code = sect.dept_code :: text) 
                       AS 
                               DEPT_CODE /* 셀.부서코드 */, 
                       (SELECT code.code_nm 
                        FROM   tc_code code 
                        WHERE  code.code_val = sect.road_grad) 
                       AS 
                               ROAD_GRAD /* 셀.도로등급 */, 
                       sect.adm_code /* 셀.행정구역코드 */, 
                       tnsmdtagnlsttus.route_code 
                       AS 
                               ROAD_NO 
                       /* 최소_구간_조사_자료.노선번호 */, 
                       tnsmdtagnlsttus.route_code :: INT 
                       AS 
                               ROAD_NO_VAL, 
                       tnrouteinfo.road_name 
                       AS 
                               ROAD_NM, 
                       CASE tnsmdtagnlsttus.direct_code 
                         WHEN 'S' THEN '상행' 
                         WHEN 'E' THEN '하행' 
                         WHEN 'SE' THEN '상하행' 
                         ELSE '' 
                       END 
                       AS 
                               DIRECT_CODE 
                       /* 최소_구간_조사_자료.행선 */, 
                       tnsmdtagnlsttus.track 
                       /* 최소_구간_조사_자료.차로 */, 
						(select code_nm from tc_code code
						WHERE code.code_val = sect.mng_rd_cd 
                            AND code.cl_code = 'MNRD' 
                            AND code.use_at = 'Y' 
                            AND code.delete_at = 'N' ) MRG_RD_NM,
                            (SELECT case when count(cntrwk_at) = 0 OR NULL then 'X' else 'O' end
 						 FROM cell_10 cell10
						 WHERE cell10.route_code = sect.route_code
						 	AND cell10.direct_code = sect.direct_code
						    AND cell10.track = sect.track
							AND cell10.strtpt = sect.strtpt) CNTRWK_AT,
				 		(SELECT case when count(unopn_at) = 0 OR NULL then 'X' else 'O' end
 						 FROM cell_10 cell10
						 WHERE cell10.route_code = sect.route_code
						 	AND cell10.direct_code = sect.direct_code
						    AND cell10.track = sect.track
							AND cell10.strtpt = sect.strtpt) UNOPN_AT,
                       tnsmdtagnlsttus.strtpt 
                       /* 최소_구간_조사_자료.시점 */, 
                       tnsmdtagnlsttus.endpt 
                       /* 최소_구간_조사_자료.종점 */, 
                       tnsmdtagnlsttus.trnsport_qy /* 교통량 */,
                       Round(tnsmdtagnlsttus.gpci, 2) 
                       AS GPCI 
                               /* 최소_구간_조사_자료.GPCI */, 
                       tnsmdtagnlsttus.cntl_dfect, 
                       (SELECT tccode.code_nm 
                        FROM   tc_code tccode 
                        WHERE  tccode.code_val = tnsmdtagnlsttus.cntl_dfect) 
                       AS 
                               CODE_NM, 
                       tnsmdtagnlsttus.ac_idx /* 주 파손.거북등균열 */, 
                       tnsmdtagnlsttus.lc_idx /* 주 파손.선형균열 */, 
                       tnsmdtagnlsttus.bc_idx /* 주 파손.블럭균열 */, 
                       tnsmdtagnlsttus.ptchg_idx /* 주 파손.패칭 */, 
                       tnsmdtagnlsttus.pothole_idx /* 주 파손.포트홀 */, 
                       tnsmdtagnlsttus.rd_idx /* 주 파손.소성변형 */, 
                       tnsmdtagnlsttus.rci /* 주 파손.종단평탄성 */, 
                       tnsmdtagnlsttus.dmg_cuz_clmt 
                       /* 주 파손.파손원인_기후 */, 
                       tnsmdtagnlsttus.dmg_cuz_vmtc 
                       /* 주 파손.파손원인_교통량 */, 
                       tnsmdtagnlsttus.dmg_cuz_etc 
               /* 주 파손.파손원인_기타 */ 
                FROM   tn_sm_dta_gnl_sttus tnsmdtagnlsttus 
                       inner join cell_sect sect 
                               ON sect.route_code = tnsmdtagnlsttus.route_code 
                                  AND sect.direct_code = 
                                      tnsmdtagnlsttus.direct_code 
                                  AND sect.track = tnsmdtagnlsttus.track 
                                  AND sect.strtpt = tnsmdtagnlsttus.strtpt  
                       left outer join tn_route_info tnrouteinfo 
                                    ON tnrouteinfo.road_no = 
                                       tnsmdtagnlsttus.route_code 
                WHERE  1 = 1 
                       AND tnsmdtagnlsttus.use_at = 'Y' 
                       AND tnsmdtagnlsttus.delete_at = 'N'
            ]]>
        <isNotEmpty property="CELL_ID"><![CDATA[ AND sect.OBJECT_ID = #OBJECT_ID# ]]></isNotEmpty>
		<isNotEmpty property="DEPT_CODE"><![CDATA[ AND sect.DEPT_CODE = #DEPT_CODE# ]]></isNotEmpty>
		<isNotEmpty property="ROAD_GRAD"><![CDATA[ AND sect.ROAD_GRAD = #ROAD_GRAD# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_YEAR"><![CDATA[ AND tnsmdtagnlsttus.SRVY_YEAR = #SRVY_YEAR# ]]></isNotEmpty>
		<isNotEmpty property="ROAD_NO"><![CDATA[ AND tnsmdtagnlsttus.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="DIRECT_CODE"><![CDATA[ AND tnsmdtagnlsttus.DIRECT_CODE = #DIRECT_CODE# ]]></isNotEmpty>
		<isNotEmpty property="TRACK"><![CDATA[ AND tnsmdtagnlsttus.TRACK = #TRACK# ]]></isNotEmpty>
		<isNotEmpty property="MRG_RD_NM"><![CDATA[ AND sect.mng_rd_cd = #MRG_RD_NM# ]]></isNotEmpty>
		<isNotEmpty property="STRTPT"><![CDATA[ AND tnsmdtagnlsttus.STRTPT >= #STRTPT#::int ]]></isNotEmpty>
		<isNotEmpty property="ENDPT"><![CDATA[ AND tnsmdtagnlsttus.ENDPT <= #ENDPT#::int ]]></isNotEmpty>
		<isNotEmpty property="CNTL_DFECT"><![CDATA[ AND tnsmdtagnlsttus.CNTL_DFECT = #CNTL_DFECT# ]]></isNotEmpty>
		<isNotEmpty property="MINGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI >= #MINGPCI#::numeric ]]></isNotEmpty>
		<isNotEmpty property="MAXGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI <= #MAXGPCI#::numeric ]]></isNotEmpty>
		<![CDATA[         
			) tb
			ORDER BY $orderByColumn$ $orderByType$
		) tnsmdtagnlsttus
		WHERE 1=1
    ]]>
    	<isNotEmpty property="CNTRWK_AT"><![CDATA[ AND CNTRWK_AT = #CNTRWK_AT# ]]></isNotEmpty>
		<isNotEmpty property="UNOPN_AT"><![CDATA[ AND UNOPN_AT = #UNOPN_AT# ]]></isNotEmpty>
		<isEqual prepend=" " property="usePage" compareValue="true">
    <![CDATA[
        AND tnsmdtagnlsttus.rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
    ]]>
		</isEqual>

	</select>


	<select id="srvyDtaExcelDAO.srvyDtaEvlInfoDetailListCnt" parameterClass="mummSctnSrvyDtaVO" resultClass="int">
    <![CDATA[
        /* srvyDtaExcelDAO.srvyDtaEvlInfoDetailListCnt */
        /* JOY_포장상태 평가정보.상세정보 목록 조회 */
        SELECT count(*)
        FROM   (SELECT Row_number() 
                 over() AS rn, 
               tb.* 
        FROM   (SELECT tnsmdtagnlsttus.srvy_no 
                       /* 최소_구간_조사_자료.조사번호 */, 
                       sect.object_id, 
                       sect.cell_id, 
                       tnsmdtagnlsttus.sm_no, 
                       Concat(tnsmdtagnlsttus.srvy_year, '.', 
                       tnsmdtagnlsttus.srvy_mt) 
                       AS 
                               SRVY_DE 
                       /* 최소_구간_조사_자료.조사월 */, 
                       tnsmdtagnlsttus.srvy_year, 
                       (SELECT tcdept.lowest_dept_nm 
                        FROM   tc_dept tcdept 
                        WHERE  tcdept.dept_code = sect.dept_code :: text) 
                       AS 
                               DEPT_CODE /* 셀.부서코드 */, 
                       (SELECT code.code_nm 
                        FROM   tc_code code 
                        WHERE  code.code_val = sect.road_grad) 
                       AS 
                               ROAD_GRAD /* 셀.도로등급 */, 
                       sect.adm_code /* 셀.행정구역코드 */, 
                       tnsmdtagnlsttus.route_code 
                       AS 
                               ROAD_NO 
                       /* 최소_구간_조사_자료.노선번호 */, 
                       tnsmdtagnlsttus.route_code :: INT 
                       AS 
                               ROAD_NO_VAL, 
                       tnrouteinfo.road_name 
                       AS 
                               ROAD_NM, 
                       CASE tnsmdtagnlsttus.direct_code 
                         WHEN 'S' THEN '상행' 
                         WHEN 'E' THEN '하행' 
                         WHEN 'SE' THEN '상하행' 
                         ELSE '' 
                       END 
                       AS 
                               DIRECT_CODE 
                       /* 최소_구간_조사_자료.행선 */, 
                       tnsmdtagnlsttus.track 
                       /* 최소_구간_조사_자료.차로 */, 
						(select code_nm from tc_code code
						WHERE code.code_val = sect.mng_rd_cd 
                            AND code.cl_code = 'MNRD' 
                            AND code.use_at = 'Y' 
                            AND code.delete_at = 'N' ) MRG_RD_NM,
                            (SELECT case when count(cntrwk_at) = 0 OR NULL then 'X' else 'O' end
 						 FROM cell_10 cell10
						 WHERE cell10.route_code = sect.route_code
						 	AND cell10.direct_code = sect.direct_code
						    AND cell10.track = sect.track
							AND cell10.strtpt = sect.strtpt) CNTRWK_AT,
				 		(SELECT case when count(unopn_at) = 0 OR NULL then 'X' else 'O' end
 						 FROM cell_10 cell10
						 WHERE cell10.route_code = sect.route_code
						 	AND cell10.direct_code = sect.direct_code
						    AND cell10.track = sect.track
							AND cell10.strtpt = sect.strtpt) UNOPN_AT,
                       tnsmdtagnlsttus.strtpt 
                       /* 최소_구간_조사_자료.시점 */, 
                       tnsmdtagnlsttus.endpt 
                       /* 최소_구간_조사_자료.종점 */, 
                       tnsmdtagnlsttus.trnsport_qy /* 교통량 */,
                       Round(tnsmdtagnlsttus.gpci, 2) 
                       AS GPCI 
                               /* 최소_구간_조사_자료.GPCI */, 
                       tnsmdtagnlsttus.cntl_dfect, 
                       (SELECT tccode.code_nm 
                        FROM   tc_code tccode 
                        WHERE  tccode.code_val = tnsmdtagnlsttus.cntl_dfect) 
                       AS 
                               CODE_NM, 
                       tnsmdtagnlsttus.ac_idx /* 주 파손.거북등균열 */, 
                       tnsmdtagnlsttus.lc_idx /* 주 파손.선형균열 */, 
                       tnsmdtagnlsttus.bc_idx /* 주 파손.블럭균열 */, 
                       tnsmdtagnlsttus.ptchg_idx /* 주 파손.패칭 */, 
                       tnsmdtagnlsttus.pothole_idx /* 주 파손.포트홀 */, 
                       tnsmdtagnlsttus.rd_idx /* 주 파손.소성변형 */, 
                       tnsmdtagnlsttus.rci /* 주 파손.종단평탄성 */, 
                       tnsmdtagnlsttus.dmg_cuz_clmt 
                       /* 주 파손.파손원인_기후 */, 
                       tnsmdtagnlsttus.dmg_cuz_vmtc 
                       /* 주 파손.파손원인_교통량 */, 
                       tnsmdtagnlsttus.dmg_cuz_etc 
               /* 주 파손.파손원인_기타 */ 
                FROM   tn_sm_dta_gnl_sttus tnsmdtagnlsttus 
                       inner join cell_sect sect 
                               ON sect.route_code = tnsmdtagnlsttus.route_code 
                                  AND sect.direct_code = 
                                      tnsmdtagnlsttus.direct_code 
                                  AND sect.track = tnsmdtagnlsttus.track 
                                  AND sect.strtpt = tnsmdtagnlsttus.strtpt  
                       left outer join tn_route_info tnrouteinfo 
                                    ON tnrouteinfo.road_no = 
                                       tnsmdtagnlsttus.route_code 
                WHERE  1 = 1 
                       AND tnsmdtagnlsttus.use_at = 'Y' 
                       AND tnsmdtagnlsttus.delete_at = 'N'
            ]]>
        <isNotEmpty property="CELL_ID"><![CDATA[ AND sect.OBJECT_ID = #OBJECT_ID# ]]></isNotEmpty>
		<isNotEmpty property="DEPT_CODE"><![CDATA[ AND sect.DEPT_CODE = #DEPT_CODE# ]]></isNotEmpty>
		<isNotEmpty property="ROAD_GRAD"><![CDATA[ AND sect.ROAD_GRAD = #ROAD_GRAD# ]]></isNotEmpty>
		<isNotEmpty property="SRVY_YEAR"><![CDATA[ AND tnsmdtagnlsttus.SRVY_YEAR = #SRVY_YEAR# ]]></isNotEmpty>
		<isNotEmpty property="ROAD_NO"><![CDATA[ AND tnsmdtagnlsttus.ROUTE_CODE = #ROAD_NO# ]]></isNotEmpty>
		<isNotEmpty property="DIRECT_CODE"><![CDATA[ AND tnsmdtagnlsttus.DIRECT_CODE = #DIRECT_CODE# ]]></isNotEmpty>
		<isNotEmpty property="TRACK"><![CDATA[ AND tnsmdtagnlsttus.TRACK = #TRACK# ]]></isNotEmpty>
		<isNotEmpty property="MRG_RD_NM"><![CDATA[ AND sect.mng_rd_cd = #MRG_RD_NM# ]]></isNotEmpty>
		<isNotEmpty property="STRTPT"><![CDATA[ AND tnsmdtagnlsttus.STRTPT >= #STRTPT#::int ]]></isNotEmpty>
		<isNotEmpty property="ENDPT"><![CDATA[ AND tnsmdtagnlsttus.ENDPT <= #ENDPT#::int ]]></isNotEmpty>
		<isNotEmpty property="CNTL_DFECT"><![CDATA[ AND tnsmdtagnlsttus.CNTL_DFECT = #CNTL_DFECT# ]]></isNotEmpty>
		<isNotEmpty property="MINGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI >= #MINGPCI#::numeric ]]></isNotEmpty>
		<isNotEmpty property="MAXGPCI"><![CDATA[ AND tnsmdtagnlsttus.GPCI <= #MAXGPCI#::numeric ]]></isNotEmpty>
		<![CDATA[         
			) tb
			ORDER BY $orderByColumn$ $orderByType$
		) tnsmdtagnlsttus
		WHERE 1=1
    ]]>
    	<isNotEmpty property="CNTRWK_AT"><![CDATA[ AND CNTRWK_AT = #CNTRWK_AT# ]]></isNotEmpty>
		<isNotEmpty property="UNOPN_AT"><![CDATA[ AND UNOPN_AT = #UNOPN_AT# ]]></isNotEmpty>
	</select>

	<select id="srvyDtaExcelDAO.srvyDtaEvlInitFmlaVar" parameterClass="pavFrmulaVO" resultClass="pavFrmulaVO">
    <![CDATA[
        /* srvyDtaExcelDAO.srvyDtaEvlInitFmlaVar */
        /* JOY_관리자 수식관리.포장상태 평가수식 변수조회 */
        SELECT
		    tnpavfrmula.FRMULA_NO
		    , tnpavfrmula.FRMULA_NM
		    , tnpavfrmulaidx.IDX_NO
		    , tnpavfrmulaidx.IDX_NM
		    , tnpavfrmulaidx.IDX_VAL
		    , tnpavfrmulaidx.DC
		    , tnpavfrmulaidx.CRTR_NO
		    , tnpavfrmulaidx.CREAT_DT
		    , tnpavfrmulaidx.UPDUSR_NO
		    , tnpavfrmulaidx.UPDT_DT
		FROM
		    TN_PAV_FRMULA_IDX tnpavfrmulaidx
		    LEFT OUTER JOIN TN_PAV_FRMULA tnpavfrmula
		    ON tnpavfrmula.FRMULA_NO = tnpavfrmulaidx.FRMULA_NO
		WHERE 1=1
            AND tnpavfrmula.FRMULA_NO != 1
		ORDER BY
		    tnpavfrmulaidx.FRMULA_NO
		    , tnpavfrmulaidx.IDX_NM
    ]]>
	</select>

	<select id="srvyDtaExcelDAO.selectPavFrmulaNo" parameterClass="pavFrmulaVO" resultClass="pavFrmulaVO">
    <![CDATA[
        /* srvyDtaExcelDAO.selectPavFrmulaNo */
        /* JOY_관리자 수식관리.수식번호 조회 */
        SELECT
		    FRMULA_NO
		FROM
		    TN_PAV_FRMULA
		WHERE 1=1
		    AND FRMULA_NM LIKE #FRMULA_NM# || '%'
    ]]>
	</select>

	<update id="srvyDtaExcelDAO.updatePavFrmulaVar">
    <![CDATA[
        /* srvyDtaExcelDAO.updatePavFrmulaVar */
        /* 평가정보 수식 변수 변경 */
        UPDATE
		    TN_PAV_FRMULA_IDX
		SET
	]]>
		<isNotEmpty property="VAR"><![CDATA[ IDX_VAL = #VAR# ]]></isNotEmpty>
		<isNotEmpty property="UPDUSR_NO"><![CDATA[ , UPDUSR_NO = #UPDUSR_NO# ]]></isNotEmpty>
        <![CDATA[
        ,UPDT_DT = NOW()
		WHERE 1=1
    	]]>
		<isNotEmpty property="VAR">
		<![CDATA[
            AND FRMULA_NO = #FRMULA_NO#
        ]]>
	        <isNotEqual property="FRMULA_NM" compareValue="TRUE">
	        <![CDATA[
	            AND IDX_NM LIKE '%' || #VAR_INDEX#
	        ]]>
	        </isNotEqual>
	        <isEqual property="FRMULA_NM" compareValue="TRUE">
	        <![CDATA[
	            AND (IDX_NM LIKE '%' || #VAR_INDEX#
			        OR IDX_NM LIKE '%' || '지수4'
			        OR IDX_NM LIKE '%' || '지수5')
	        ]]>
	        </isEqual>
		</isNotEmpty>

	</update>

</sqlMap>
